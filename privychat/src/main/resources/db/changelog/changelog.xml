<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:mongodb="http://www.liquibase.org/xml/ns/mongodb"
        xsi:schemaLocation="
          http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd
          http://www.liquibase.org/xml/ns/mongodb http://www.liquibase.org/xml/ns/mongodb/liquibase-mongodb-latest.xsd">

    <property name="usersCollection" value="users"/>
    <property name="chatsCollection" value="chats"/>
    <property name="messagesCollection" value="messages"/>

    <changeSet id="v1-create-collections" author="privychat" labels="collections,index-init">
        <mongodb:createCollection collectionName="${usersCollection}"/>
        <mongodb:createCollection collectionName="${chatsCollection}"/>
        <mongodb:createCollection collectionName="${messagesCollection}"/>
    </changeSet>

    <changeSet id="v1-create-indexes" author="privychat" labels="indexes" runOnChange="true">
        <!-- Users unique username -->
        <mongodb:createIndex collectionName="${usersCollection}">
            <mongodb:keys>{"username": 1}</mongodb:keys>
            <mongodb:options>{"name": "idx_users_username", "unique": true}</mongodb:options>
        </mongodb:createIndex>

        <!-- Chats explicit _id index (although Mongo creates one by default) -->
        <mongodb:createIndex collectionName="${chatsCollection}">
            <mongodb:keys>{"_id": 1}</mongodb:keys>
            <mongodb:options>{"name": "idx_chats_id"}</mongodb:options>
        </mongodb:createIndex>

        <!-- Messages explicit _id index -->
        <mongodb:createIndex collectionName="${messagesCollection}">
            <mongodb:keys>{"_id": 1}</mongodb:keys>
            <mongodb:options>{"name": "idx_messages_id"}</mongodb:options>
        </mongodb:createIndex>
    </changeSet>

</databaseChangeLog>