<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:mongodb="http://www.liquibase.org/xml/ns/mongodb"
        xsi:schemaLocation="
          http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd
          http://www.liquibase.org/xml/ns/mongodb http://www.liquibase.org/xml/ns/mongodb/liquibase-mongodb-latest.xsd">

    <property name="usersCollection" value="users"/>
    <property name="chatsCollection" value="chats"/>
    <property name="messagesCollection" value="messages"/>

    <changeSet id="v1-create-collections" author="privychat" labels="collections,index-init">
        <mongodb:createCollection collectionName="${usersCollection}"/>
        <mongodb:createCollection collectionName="${chatsCollection}"/>
        <mongodb:createCollection collectionName="${messagesCollection}"/>
    </changeSet>

    <changeSet id="v1-create-indexes" author="privychat" labels="indexes" contextFilter="prod,dev" runOnChange="true">
        <mongodb:createIndex collectionName="${usersCollection}">
            <mongodb:keys>{"username": 1}</mongodb:keys>
            <mongodb:options>{"unique": true}</mongodb:options>
        </mongodb:createIndex>
        <mongodb:createIndex collectionName="${chatsCollection}">
            <mongodb:keys>{"chatId": 1}</mongodb:keys>
        </mongodb:createIndex>
        <mongodb:createIndex collectionName="${messagesCollection}">
            <mongodb:keys>{"msgId": 1}</mongodb:keys>
        </mongodb:createIndex>
    </changeSet>

</databaseChangeLog>